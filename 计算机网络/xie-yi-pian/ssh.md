# SSH

\[TOC]

## 介绍

* SSH 又称： 安全外壳协议， 是一种加密的网络传输协议，可以在不安全的网络中为网络服务提供安全的传输环境，SSH 可以通过在网络创建安全隧道来实现 SSH 客户端和服务器之间的连接。
*   基本架构：

    | 协议     | 描述                                   |
    | ------ | ------------------------------------ |
    | 传输层协议  | 传输层协议提供服务器认证，数据机密性，信息完整性等的支持         |
    | 用户认证协议 | 用户认证协议为服务器提供客户端的身份鉴别                 |
    | 连接协议   | 连接协议将加密的信息隧道复用成若干个逻辑通道，提供给更高层的应用协议使用 |
*   SSH 的安全验证：

    在客户端来看，SSH提供两种级别的安全验证。

    * 第一种级别（基于密码的安全验证），知道帐号和密码，就可以登录到远程主机，并且所有传输的数据都会被SSH传输层协议加密。但是，可能会有别的服务器在冒充真正的服务器，但只要客户端校验主机公钥，在服务器私钥不泄露的前提下就能避免被“中间人”攻击。
    * 第二种级别（基于密钥的安全验证），需要依靠密钥，也就是你必须为自己创建一对密钥，并把公钥放在需要访问的服务器上。客户端软件会向服务器发出请求，请求用你的私钥进行安全验证并发送使用私钥对会话ID等信息的签名。服务器收到请求之后，先在你在该服务器的用户根目录下寻找你的公钥，然后把它和你发送过来的公钥进行比较，并用公钥检验签名是否正确。如果两个密钥一致，且签名正确，服务器就认为用户登录成功。

    在服务器端来看，SSH也提供安全验证。

    * 服务器将自己的公钥分发给相关的客户端，并将密钥交换过程中的公开信息与协商密钥的哈希值的签名发送给客户端，客户端将获取的服务器公钥计算指纹并与其他安全信道获得的公钥指纹相比对并验证主机签名。
    * 存在一个密钥认证中心，所有提供服务的主机都将自己的公钥提交给认证中心，公钥认证中心给服务端颁发证书，而任何作为客户端的主机则只要保存一份认证中心的公钥就可以了。在这种模式下，服务器会发送认证中心提供给主机的证书与主机对密钥交换过程中公开信息的签名。客户端只需要验证证书的有效性并验证签名。
